<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Serverseitige Logik mit Servlets</title>

        <link rel="shortcut icon" href="../../favicon.svg" />
        <link rel="stylesheet" href="../../style.css" />
        <script src="../../learning-slides.bundle.js"></script>
    </head>
    <body class="slides invisible" data-title="Serverseitige Logik mit Servlets" tabindex="0">
        <header>
            <h2>Inhaltsverzeichnis</h2>
            <p>
                In diesem Kapitel bauen wir auf deinem Wissen zu HTTP und Java Server
                Pages auf und vervollst√§ndigen nun das Bild vom Server. Du erf√§hrst
                hier, wie der serverseitige Quellcode einer Webanwendung √ºberlicherweise
                gegliedert ist lernst die Programmierung in Java als konkretes Beispiel
                kennen. Mit diesem Wissen ausger√ºstet kannst du dich dann auch in
                vielen anderen Webframeworks schnell zurechtfinden.
            </p>
        </header>

        <section>
            <h1>Die drei Arten von Webanwendungen</h1>
            <article>
                <div>
                    <ul class="nav nav-tabs" role="tablist">
                        <li class="nav-item">
                            <a
                                id            = "webanwendungen-browser-tab"
                                class         = "nav-link active"
                                data-toggle   = "tab"
                                href          = "#webanwendungen-browser"
                                role          = "tab"
                                aria-controls = "webanwendungen-browser"
                                aria-expanded = "true"
                            >
                                Komplett im Browser
                            </a>
                        </li>
                        <li class="nav-item">
                            <a
                                id            = "webanwendungen-server-tab"
                                class         = "nav-link"
                                data-toggle   = "tab"
                                href          = "#webanwendungen-server"
                                role          = "tab"
                                aria-controls = "webanwendungen-server"
                            >
                                Komplett auf dem Server
                            </a>
                        </li>
                        <li class="nav-item">
                            <a
                                id            = "webanwendungen-beides-tab"
                                class         = "nav-link"
                                data-toggle   = "tab"
                                href          = "#webanwendungen-beides"
                                role          = "tab"
                                aria-controls = "webanwendungen-beides"
                            >
                                Sowohl als auch
                            </a>
                        </li>
                    </ul>
                    <div class="tab-content border border-top-0 bg-white" style="padding: 1em;">
                        <!-- Komplett im Browser -->
                        <div
                            class           = "tab-pane fade show active"
                            id              = "webanwendungen-browser"
                            role            = "tabpanel"
                            aria-labelledby = "webanwendungen-browser-tab"
                        >
                            <img src="webanwendung_01.svg" class="d-block" style="width: 100%;" />

                            <p>
                                <small>
                                    <small>
                                        Bildnachweis f√ºr das Smartphone: <a href="https://pixabay.com/de/iphone-handy-apple-telefon-mobil-160307/" target="_blank">Pixabay: OpenClipart-Vectors</a>
                                    </small>
                                </small>
                            </p>

                            <ul>
                                <li>
                                    Die komplette Anwendungslogik befindet sich im Browser (JavaScript)
                                </li>
                                <li>
                                    Die Anwendung kann lokal komplett ohne Server ausgef√ºhrt werden
                                </li>
                                <li>
                                    Ein Server wird nur ben√∂tigt, wenn die Anwendung √ºber das Internet aufrufbar sein soll
                                </li>
                                <li>
                                    Mit <a href="http://cordova.apache.org/" target="_blank">Phonegap/Cordova</a> erstelle mobile Anwendungen funktionieren auch nach diesem Prinzip
                                </li>
                            </ul>
                        </div>
                        <!-- Komplett auf dem Server -->
                        <div
                            class           = "tab-pane fade"
                            id              = "webanwendungen-server"
                            role            = "tabpanel"
                            aria-labelledby = "webanwendungen-server-tab"
                        >
                            <img src="webanwendung_02.svg" class="d-block" style="width: 100%;" />

                            <ul>
                                <li>
                                    <b class="dhbw-lightblue">Der Klassiker:</b> Die Anwendungslogik liegt komplett auf dem Server
                                </li>
                                <li>
                                    JavaScript kommt im Browser wenn √ºberhaupt nur sehr sparsam zum Einsatz
                                </li>
                                <li>
                                    Stattdessen f√ºhrt jede Aktion dazu, dass eine neue Seite vom Server geladen wird
                                </li>
                                <li>
                                    Der Server f√ºhrt dabei die Anwendungslogik aus und generiert das anzuzeigende HTML
                                </li>
                            </ul>
                        </div>
                        <!-- Sowohl als auch -->
                        <div
                            class           = "tab-pane fade"
                            id              = "webanwendungen-beides"
                            role            = "tabpanel"
                            aria-labelledby = "webanwendungen-beides-tab"
                        >
                            <img src="webanwendung_03.svg" class="d-block" style="width: 100%;" />

                            <ul>
                                <li>
                                    <b class="dhbw-lightblue">Das Beste beider Welten:</b> Browser und Server beinhalten je einen Teil der Anwendungslogik
                                </li>
                                <li>
                                    Der HTML-Code der Seite kann zur Laufzeit generiert werden oder in einer einfachen HTML-Datei liegen
                                </li>
                                <li>
                                    Bei verschiedenen Aktionen werden mit JavaScript weitere Daten mit dem Server ausgetauscht
                                </li>
                                <li>
                                    Die empfangenen Daten werden dabei durch geschickte DOM-Manipulation sichtbar gemacht
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </article>
            <aside>
                <p>
                    Bevor wir nun anfangen k√∂nnen, den Server in unsere Webanwendungen miteinzubeziehen, musst du
                    erst verstehen, welche M√∂glichkeiten es hierf√ºr gibt. Denn davon h√§ngt ma√ügeblich ab, wie
                    die Webanwendungen aufgebaut sind und wie aufw√§ndig ihre Programmierung m√∂glicherweise wird.
                    Die zentrale Frage dabei ist einfach, welche Aufgabe der Server √ºberhaupt haben soll:
                </p>
                <ol>
                    <li>
                        Die Anwendung l√§uft im Browser und ben√∂tigt keinen Server
                    </li>
                    <li>
                        Die Anwendung wird komplett serverseitig realisiert
                    </li>
                    <li>
                        Die Anwendung l√§uft im Browser, greift aber auf einzelne Serverfunktionen zur√ºck
                    </li>
                </ol>
                <p>
                    Jeder dieser Ans√§tze hat seine ganz eigenen Vor- und Nachteile, weshalb es immer vom konkreten
                    Anwendungsfall abh√§ngt, welcher gerade am besten geeignet ist. Doch auch dann h√§ngt es immer
                    ein wenig von den eigenen Vorlieben ab, welcher Ansatz einem am leichtesten f√§llt. üêä
                </p>

                <h2>Browser Apps ohne Server</h2>
                <p>
                    Eigentlich waren Browser ja nur als einfache Anzeigeprogramme konzipiert, mit denen man eben
                    im Web surfen und HTML-Seiten anzeigen konnte. Doch sp√§testens seit HTML5 hat sich die Idee
                    durchgesetzt, den Browser als <a href="https://xkcd.com/1367/" target="_blank">vollwertige
                    Laufzeitumgebung f√ºr universelle Apps</a> zu nutzen. Viele Webanwendungen laufen daher, sobald
                    sie einmal geladen wurden, allein im Browser mit keinerlei Server im Hintergrund, weshalb dem
                    JavaScript-Code hier eine besondere Bedeutung zukommt. Dass dabei auch beeindruckende Ergebnisse
                    m√∂glich sind, zeigen folgende Beispiele:
                </p>
                <ul>
                    <li>
                        <a href="https://dx7.vstforx.de/" target="_blank">Yamaha DX7 Online-Emulation</a>
                    </li>
                    <li>
                        <a href="http://www.playmapscube.com/" target="_blank">Google Maps Cube</a>
                    </li>
                    <li>
                        <a href="http://www.ellison.rocks/clumsy-bird/" target="_blank">Clumsy Bird</a>
                    </li>
                </ul>
                <p>
                    Mit <a href="http://cordova.apache.org/" target="_blank">Phonegap bzw. Cordova</a> entwickelte
                    Mobile Apps üì± funktionieren √ºbrigens genauso. Es handelt sich dabei lediglich um HTML-, CSS- und
                    JavaScript-Dateien, die in einer Art Vollbildbrowser angezeigt werden.
                </p>

                <h2>Komplett serverseitige Webanwendungen</h2>
                <p>
                    Dies ist die klassische Art von Webanwendungen, wie es sie schon in den fr√ºhen Tagen des Webs gab,
                    als noch die Dinosaurier die Welt beherrschten. üê≤ Der Browser zeigt hier lediglich den HTML-Code
                    an, den er vom Server geschickt bekommt. Jeder Mausklick bzw. generell jede Aktion des Anwenders
                    f√ºhrt dazu, dass eine neue Seite geladen wird, weshalb browserseitig kein oder nur sehr wenig
                    JavaScript zum Einsatz kommt. Denn im Prinzip wird JavaScript hier auch gar nicht ben√∂tigt, da der
                    Browser bei jedem Klick auf einen Link oder beim Abschicken eines Formulars ohnehin ganz von alleine
                    eine neue Seite anfordert.
                </p>
                <p>
                    Der angezeigte HTML-Code wird in der Regel zur Laufzeit vom Server generiert. Jedes mal, wenn der
                    Browser eine Seite anfordert und hierf√ºr eine HTTP-Anfrage schickt, f√ºhrt der Server die gew√ºnschte
                    Aktion aus und erzeugt eine neue HTML-Seite, in der das Ergebnis dargestellt wird.
                </p>

                <h2>Der Server als Funktionsbibliothek</h2>
                <p>
                    Auch wenn viele Webframeworks noch aus der Welt der rein serverseitigen Webanwendungen stammen,
                    setzt sich heute immer mehr eine strikte Trennung zwischen dem Frontend und dem Backend einer
                    Webanwendung durch. üî™
                </p>
                <p>
                    Der Browser ist hierbei das Frontend und f√ºhrt eine Webseite bestehend aus
                    HTML, CSS und JavaScript-Code aus. Diese muss nat√ºrlich erst vom Server geladen werden, weshalb
                    manche Anwendungen den HTML-Code, wie bei einer herk√∂mmlichen Webanwendung, vom Server dynamisch
                    erzeugen lassen. Meistens wird darauf aber verzichtet, um Frontend und Backend unabh√§ngig voneinander
                    und h√§ufig auch in getrennten Teams entwickeln zu k√∂nnen.
                </p>
                <p>
                    Hauptaufgabe des Servers ist es in diesem Fall, Funktionen bereitzustellen, die der Browser
                    via JavaScript aufrufen kann (vgl. <a href="https://de.wikipedia.org/wiki/Ajax_(Programmierung)" target="_blank">
                    AJAX</a> und <a href="https://de.wikipedia.org/wiki/WebSocket" target="_blank">WebSockets</a>).
                    Das automatische Neuladen der Seite soll dabei m√∂glichst vermieden werden, weshalb du alle
                    Aufrufe in JavaScript selbst ausprogrammieren musst. Dabei musst du dann auch die empfangenen
                    Antwortdaten durch geschickte DOM-Manipulation in der Seite sichtbar machen.
                </p>
                <p>
                    Vorteil dieses Ansatzes ist, dass die serverseitigen Funktionen aus unterschiedlichen Frontends
                    heraus konsumiert werden k√∂nnen, beispielsweise einer Webseite und einer Desktopanwendung. Auch
                    kann eine so entwickelte Webanwendung l√§ngere Offlinezeiten √ºberstehen, solange sie keine Verbindung
                    zum Server ben√∂tigt. Hierf√ºr muss allerdings eine gute Schnittstelle zwischen Client und Server
                    definiert werden¬π, was nicht immer ganz einfach ist. N√§chstes Semester werden wir mit
                    <a href="https://de.wikipedia.org/wiki/SOAP" target="_blank">SOAP-</a> und
                    <a href="https://de.wikipedia.org/wiki/Representational_State_Transfer" target="_blank">REST</a>-Webservices
                    jedoch zwei weit verbreitete Techniken kennenlernen. üé≠
                </p>
                <p>
                    <small>
                        ¬π Welche Funktionen bietet der Server? Wie werden sie aufgerufen? Welche Daten m√ºssen dabei
                        an den Server √ºbertragen werden? Mit welchen Daten antwortet er? In welcher Reihenfolge sind
                        die Funktionen aufzurufen? Und so weiter ‚Ä¶
                    </small>
                </p>
            </aside>
        </section>

        <section>
            <h1>Was der Server bei einer Anfrage macht</h1>
            <article>
                <img src="struktur.svg" class="d-block" style="width: 100%; box-sizing: border-box; padding: 1em;" />
            </article>
            <aside>
                <p>
                    Die folgende Abbildung zeigt den typischen Ablauf, wie die meisten Webframeworks eingehende HTTP-Anfragen
                    auf dem Server bearbeiten. Nat√ºrlich besitzt jedes Framework etwas andere Begrifflichkeiten und auch die
                    Programmierung unterscheidet sich teilweise deutlich. Im Wesentlichen machen sie aber immer die folgenden
                    drei Dinge:
                </p>

                <h2>Wohin mit der Anfrage?</h2>
                <p>
                    Im ersten Schritt wird die in der Anfrage enthaltene URL ausgewertet. Dabei geht es vor allem darum
                    herauszufinden, welcher Teil der Webanwendung f√ºr die Anfrage zust√§ndig ist. Dieser Schritt wird daher
                    auch <b>Routing</b> genannt, da die Anfrage anhand ihrer URL serverintern an die richtige Stelle
                    weitergeleitet wird. Die meisten Frameworks erlauben es daher, Routingregeln f√ºr die URLs zu definieren.
                </p>
                <p>
                    Ein einfaches Beispiel f√ºr einen Blog üìñ k√∂nnte dabei wie folgt aussehen:
                </p>
                <table style="margin-bottom: 1.5em;">
                    <tr>
                        <td>
                            <tt>/</tt>
                        </td>
                        <td>
                            ‚Üí
                        </td>
                        <td>
                            Startseite
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <tt>/article/</tt>
                        </td>
                        <td>
                            ‚Üí
                        </td>
                        <td>
                            √úbersicht mit allen Bloggeintr√§gen
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <tt>/article/<span style="color: darkred">${name}</span>/</tt>
                        </td>
                        <td>
                            ‚Üí
                        </td>
                        <td>
                            Inhalt eines einzelnen Bloggeintrags
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <tt>/article/<span style="color: darkred">${name}</span>/comments</tt>
                        </td>
                        <td>
                            ‚Üí
                        </td>
                        <td>
                            Kommentare zu einem bestimmten Bloggeintrag
                        </td>
                    </tr>
                </table>

                <h2>Der Request Handler ist dran</h2>
                <p>
                    Durch das Routing wird die Anfrage an einen sogenannten <b>Request Handler</b> weitergeleitet. Je
                    nach Programmiersprache und Framework handelt es sich dabei um eine Klasse, Methode oder eine Funktion,
                    in jedem Fall also zum Programmcode, der zur Bearbeitung der Anfrage ausgef√ºhrt wird. Er bekommt daher
                    alle Daten der HTTP-Anfrage √ºbergegeben und kann auch eine Antwort generieren.
                </p>
                <p>
                    Hier liegt daher die Anwendungslogik des Servers, wo zum Beispiel Datens√§tze aus einer Datenbank gelesen
                    oder neue Eintr√§ge gespeichert werden k√∂nnen. üíæ
                </p>

                <h2>Erzeugung des HTML-Codes</h2>
                <p>
                    Nachdem die gew√ºnschte Aktion vom Request Handler ausgef√ºhrt wurde (zum Beispiel einen neuen Blogeintrag
                    zu speichern oder einen vorhandenen Eintrag aus der Datenbank zu lesen), wird die Anfrage in aller Regel
                    an ein <b>HTML-Template</b> weitergereicht, um daraus die anzuzeigende Seite zu generieren. Dabei kommt
                    dann wieder das Prinzip mit den Platzhaltern zum Tragen, wobei das Template verschiedene Platzhalter
                    enth√§lt, die vom Request Handler mit Inhalten ausgef√ºllt werden. Die hierf√ºr ben√∂tigten Daten werden deshalb
                    in einen sogenannten <b>Kontext</b> (eine Name/Wert-Liste) geschrieben, den das Template auslesen kann.
                </p>
                <p>
                    Alternativ kann der Request Handler auch einfach direkt eine HTTP-Antwort erzeugen, wenn zum Beispiel
                    ein Format wie PDF oder JSON als Antwort erwartet wird. In diesem Fall entf√§llt denn der zus√§tzliche
                    Schritt mit dem Template.
                </p>
            </aside>
        </section>

        <section>
            <h1>Und nun das ganze mit Java</h1>
            <article>
                ‚Ä¶
            </article>
            <aside>
                <p>
                    ‚Ä¶
                </p>
            </aside>
        </section>

        <section>
            <h1>Die wichtigsten Servlet-Methoden</h1>
            <article>
                ‚Ä¶
            </article>
            <aside>
                <p>
                    ‚Ä¶
                </p>
            </aside>
        </section>

        <section>
            <h1>Beispiel: Ein Servlet sagt ‚ÄûHallo‚Äù</h1>
            <article>
                <!-- FORM GET/POST-Pattern f√ºr ein einfaches "Hallo Welt" -->
                ‚Ä¶
            </article>
            <aside>
                <p>
                    ‚Ä¶
                </p>
            </aside>
        </section>

        <section data-background-color="rgb(231, 221, 141)">
            <h1>Aufgabe 1: Ein kleines Servlet-Quiz</h1>
            <article>
                ‚Ä¶
            </article>
            <aside>
                <p>
                    ‚Ä¶
                </p>
            </aside>
        </section>

        <section>
            <h1>Weiterleitung an eine Java Server Page</h1>
            <article>
                ‚Ä¶
            </article>
            <aside>
                <p>
                    ‚Ä¶
                    <!-- (1) RequestDispatcher -->
                    <!-- (2) Wenige wichtige JSP Tags und Expressions -->
                </p>
            </aside>
        </section>

        <section>
            <h1>Beispiel: ‚ÄûHallo Welt‚Äù gleich viel sch√∂ner</h1>
            <article>
                ‚Ä¶
            </article>
            <aside>
                <p>
                    ‚Ä¶
                </p>
            </aside>
        </section>

        <section>
            <h1>Die drei Kontexte im Detail</h1>
            <article>
                ‚Ä¶
            </article>
            <aside>
                <p>
                    ‚Ä¶
                </p>
            </aside>
        </section>

        <section data-background-color="rgb(231, 221, 141)">
            <h1>Aufgabe 2: Eine klitzekleine Webanwendung</h1>
            <article>
                <!-- Mini TODO-Liste: Ein <input /> und ein <ol> auf einer Seite -->
                ‚Ä¶
            </article>
            <aside>
                <p>
                    ‚Ä¶
                </p>
                <img src="../../github_atom.png" class="img-fluid d-block"/>
                <p>
                    <small>
                        Bildnachweis:
                        <a href="https://atom.io/" target="_blank">Atom Webseite</a>
                    </small>
                </p>
            </aside>
        </section>

        <section data-background-color="rgb(158, 203, 231)">
            <h1>Rechtshinweise</h1>
            <article>
                <h4>Creative Commons Namensnennung 4.0 International</h4>
                <ul>
                    <li>Beliebiges Teilen ist erlaubt</li>
                    <li>Die Unterlagen d√ºrfen bearbeitet und ver√§ndert werden</li>
                    <li>Wenn die Namens- und Urheberangaben erhalten bleiben</li>
                    <li>Und keine weiteren Einschr√§nkungen auferlegt werden</li>
                </ul>
                <span style="font-size: 400px; color: white;" class="dhbw-text-shadow" >¬ß</span>
            </article>
            <aside style="font-size: 80%">
                <h4>Kontaktdaten</h4>
                <p>
                    Dennis Schulmeister-Zimolong<br/>
                    E-Mail: dhbw@windows3.de<br/>
                </p>

                <h4>Urheberrecht und Lizenzvereinbarung</h4>
                <p>
                    ¬© 2017 Dennis Schulmeister-Zimolong <br/>
                    <a href="https://github.com/DennisSchulmeister/dhbwka-wwi-webprog-folien" target="_blank">https://github.com/DennisSchulmeister/dhbwka-wwi-webprog-folien</a>
                </p>
                <img src="https://i.creativecommons.org/l/by/4.0/88x31.png" alt="Creative Commons Lizenzvertrag" />
                <p>
                    Das Werk <i>Vorlesung "Webprogrammierung" im Studiengang Wirtschaftsinformatik
                    an der DHBW Karlsruhe</i> von <a href="http://www.windows3.de" target="_blank">Dennis Schulmeister-Zimolong</a>
                    ist lizenziert unter <a href="http://creativecommons.org/licenses/by/4.0/" target="_blank"><i>Creative Commons
                    Namensnennung 4.0 International</i></a>.
                </p>
                <p>
                    Du darfst:
                </p>
                <ul>
                    <li>
                        <b>Teilen</b> ‚Äî das Material in jedwedem Format oder Medium vervielf√§ltigen
                        und weiterverbreiten
                    </li>
                    <li>
                        <b>Bearbeiten</b> ‚Äî das Material remixen, ver√§ndern und darauf aufbauen
                        und zwar f√ºr beliebige Zwecke, sogar kommerziell.
                    </li>
                </ul>
                <p>
                    Unter folgenden Bedingungen:
                </p>
                <ul>
                    <li>
                        <b>Namensnennung</b> ‚Äî Du musst angemessene Urheber- und Rechteangaben
                        machen, einen Link zur Lizenz beif√ºgen und angeben, ob √Ñnderungen
                        vorgenommen wurden. Diese Angaben d√ºrfen in jeder angemessenen Art
                        und Weise gemacht werden, allerdings nicht so, dass der Eindruck
                        entsteht, der Lizenzgeber unterst√ºtze gerade dich oder deine Nutzung
                        besonders.
                    </li>
                    <li>
                        <b>Keine weiteren Einschr√§nkungen</b> ‚Äî Du darfst keine zus√§tzlichen Klauseln
                        oder technische Verfahren einsetzen, die anderen rechtlich irgendetwas
                        untersagen, was die Lizenz erlaubt.
                    </li>
                </ul>
                <p>
                    Es werden keine Garantien gegeben und auch keine Gew√§hr geleistet.
                    Die Lizenz verschafft dir m√∂glicherweise nicht alle Erlaubnisse,
                    die du f√ºr die jeweilige Nutzung brauchst. Es k√∂nnen beispielsweise
                    andere Rechte wie Pers√∂nlichkeits- und Datenschutzrechte zu beachten
                    sein, die deine Nutzung des Materials entsprechend beschr√§nken.
                </p>
            </aside>
        </section>
    </body>
</html>
